{% extends "base.html" %}

{% block title %}Stock Simulator 2014 - Home{% endblock %}

{% block content %}
  <div class="well">
    <div id="graph-container" style="width:100%; height:400px;"></div>
  </div>
  
  <div class="row">
    <div class="span8">
      <h2> Owned stock </h2>
      <table id="ownedStock" class="table table-hover">
      <thead>
        <tr>
          <th> Symbol </th>
          <th> Stock owned </th>
          <th> Prev. open price </th>
          <th> Prev. close price </th>
          <th> Current price </th>
          <th> Current bid price </th>
          <th> Current ask price </th>
        </tr>
      </thead>
      <tbody>
        {% for stock in user.get_profile.stocks %}
          {% with stock.company.historicData|last as last %}
        <tr>
          <td> <abbr title="{{ stock.company.longName }}">{{ stock.company.shortName }}</abbr> </td>
          <td> {{ stock.amount }} </td>
          <td> {{ last.openPrice }} </td>
          <td> {{ last.closePrice }} </td>
          {% endwith %}
          {% with stock.company.dailyData|last as last %}
          <td> {{ last.currentPrice }} </td>
          <td> {{ last.bidPrice }} </td>
          <td> {{ last.askPrice }} </td>
          {% endwith %}
        </tr>
        {% endfor %}
      </tbody>
      </table>
  
    </div>
 
    <div class="span4">
      <div class="bordered-div">
        <h2> News </h2>
        {% for newsItem in news %}
          <div class="news-row">
            <span class="news-date pull-right">{{ newsItem.2|date:"d-m-y" }}</span>
            <a href=#>{{ newsItem.0 }}</a>
          </div>
        {% endfor %}
      </div>
    </div>
  </div>
{% endblock %}

{% block scripts %}
  <link type="text/css" rel="stylesheet" href="{{ STATIC_URL }}css/dataTables_bootstrap.css"></link>
  <script type="text/javascript" charset="utf-8" src="{{ STATIC_URL }}js/jquery.dataTables.js"></script>
  <script src="{{ STATIC_URL }}js/dataTables_bootstrap.js" language="javascript" charset="utf-8" type="text/javascript"></script>
  
  <script src="http://code.highcharts.com/stock/highstock.js"></script>
  <script src="http://code.highcharts.com/stock/modules/exporting.js"></script>
  <script type="text/javascript">
  $(function() {
      window.chart = new Highcharts.StockChart({
          chart : {
              renderTo : 'graph-container'
          },
          title : {
              text : 'AAPL Stock Price'
          },
          series : [{
              name : 'AAPL',
              data : [
                  [Date.UTC(2006, 0, 29, 0, 0, 0), 30.14],
                  [Date.UTC(2006, 0, 29, 1, 0, 0), 34.76],
                  [Date.UTC(2006, 0, 29, 2, 0, 0), 34.34],
                  [Date.UTC(2006, 0, 29, 3, 0, 0), 33.9]
              ]
          }]
      });
      
      $( "#home-button" ).addClass("active")
      
      $( "#ownedStock" ).dataTable(
      {
        "sDom": "<'row'<'span4'l><'span4'f>r>t<'row'<'span4'i><'span4'p>>",
      });
      
      $( "tbody>tr" ).click(function()
      {
        location.href = $( this.cells[0] ).text()
      });
      
      $( "tbody>tr" ).hover(function() 
      {
        $(this).css('cursor','pointer');
      }, function() 
      {
        $(this).css('cursor','auto');
      });
  });  
  </script>
  

{% endblock %}
